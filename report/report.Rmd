---
title: "Area under ROC curve – review and efficient computation in R"
date: "2025-10-28"
abstract: >
  The AUC (Area Under the Curve) measure is widely used in statistical classification and machine learning, including credit scoring, where it is employed to assess the quality of predictive models. The goal of this paper is to review methods for calculating the AUC measure, followed by an analysis of the efficiency of computing this measure in R.
draft: true
author:  
  - name: Błażej Kochański
  - name: Przemysław Pepliński
    affiliation: Gdańsk University of Technology
    address:
    - Faculty of Management and Economics
    - Gdańsk
  - name: Miriam Nieslona
  - name: Wiktor Galewski
  - name: Piotr Geremek
 
type: package
output: 
  rjtools::rjournal_article:
    self_contained: yes
    toc: no
bibliography: RJreferences.bib

---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, warning = FALSE, message = FALSE)
library(plotly)
library(ggplot2)
library(kableExtra)
```

# Introduction

ROC curves...

# Background


```{r auc-gini, fig.align = "center", out.width = "100%", fig.cap="Geometric interpretation: AUC (AUROC) is the area under the ROC curve, Gini is twice the area between the diagonal y=x and the ROC curve.", dev=if(knitr::is_latex_output()) "cairo_pdf" else "png"}
cz = c(.6, .8, .95)
sw = c(.9, .8, .6)

df <- data.frame(FPR = c(0, 1-sw, 1), TPR = c(0, cz, 1))

library(ggplot2)
library(patchwork)

ggplot(df, aes(x = FPR, y = TPR)) +
  annotate("rect", xmin = 0, xmax = 1, ymin = 0, ymax = 1, fill = "white", color = "black") +
  geom_area(fill="lightblue") +
  geom_line() +
  geom_point() +
  annotate("text", x = 0.5, y = 0.5, label = "AUC", size =10,  color = "darkblue") +
  coord_fixed(ratio = 1, xlim = c(0,1), ylim = c(0,1)) +
  labs(x = "FPR (1 - specificity)\ncumulative fraction of goods", 
       y = "TPR (sensitivity)\ncumulative fraction of bads") +
  theme_minimal() +

#library(ggplot2)
ggplot(df, aes(x = FPR, y = TPR)) +
  annotate("rect", xmin = 0, xmax = 1, ymin = 0, ymax = 1, fill = "white", color = "black") +
  geom_polygon(fill="orange2") +
  geom_polygon(aes(x=TPR, y=FPR), fill="orange1") +
  geom_line() +
  geom_point() +
  annotate("text", x = 0.5, y = 0.5, label = "Gini", size =10,  color = "orange4") +
  coord_fixed(ratio = 1, xlim = c(0,1), ylim = c(0,1)) +
  labs(x = "FPR (1 - specificity)\ncumulative fraction of goods", y = "") +
  theme_minimal()
```



# AUC – alternative names and formulas

--> ** O czym trzeba wspomnieć: ** <--

AUC is referred to as:

* C-statistic
* a version of estimator of the common language effect size statistic 
* probability of superiority
* “Vargha & Delaney A” (“measure of stochastic superiority”) [@Vargha_Delaney_2000]
* “relative treatment effect” / “stochastic superiority statistic” in the Brunner-Munzel test 

Gini coefficient is also referred to as:

* pseudo Gini [@Idczak_2019]
* a version of the rank-biserial correlation coefficient
* accuracy ratio based on the Cumulative Accuracy Profile
* a special case of the Somers' D statistic
* Cliff's delta [@Cliff_1993]

* Relation to the U statistic in the Mann-Whitney. 

* Relation to the Somers' D. 

* Cumulative Accuracy profile. 


# The need for computational efficiency in AUC estimation

Opisać: 

- AUC / Gini bootstrapping / permutation tests

  - including DALEX (?)

- AUC optimization algorithms

- credit market simulation

 [@Kochanski_2021] 

- inne ...

# R packages

--> Tutaj należy wstawić tabelkę pana Wiktora <--


We identified three main types of algorithms for AUC computation: (1) trapezoidal integration over the ROC Curve, (2) (optimized) pairwise comparison, (3) and rank-based (Mann–Whitney U statistic formulation).

Let $(s_i, y_i)$ for $i = 1, \dots, n$ denote the score assigned to an account and its corresponding true label. In line with standard practice in credit scoring, we assume that $y_i=1$ indicates a "bad" account (e.g., one that defaults, doesn't repay the loan), while $y_i=0$ represents a good account. A properly functioning scoring should assign lower scores to accounts with a higher predicted probability of being bad, and higher scores to those likely to be good.

Let $n_1 = \sum_{i=1}^{n}\mathbb{I}(y_i=1)$ denote the number of bad accounts, and $n_0 = \sum_{i=1}^{n}\mathbb{I}(y_i=0)$ – number of good accounts.

**Trapezoidal Integration over the ROC Curve**

$$\text{AUC} = \sum_{k=1}^{m-1}(\text{FPR}_{k+1} - \text{FPR}_{k})\cdot\frac{\text{TPR}_{k+1}+\text{TPR}_k}{2}$$

where $m$ is the number of distinct score thresholds from lowest to the highest score, TPR --> dokończyć <--

**Optimized Pairwise Comparison**

AUC as the probability that a randomly chosen positive instance receives a higher score than a randomly chosen negative instance:

$$\text{AUC} = \frac{1}{n_1 n_0}\sum_{i:y_i=1}\sum_{j:y_j=0}\left[\mathbb{I}(s_i<s_j)+\frac{1}{2}\mathbb{I}(s_i=s_j)\right]$$

Generally, naive pairwise comparison is not efficient (?), but ...

## Rank-Based (Mann–Whitney U Statistic Formulation)

$$\text{AUC} = \frac{\bar{R}_{1}-{n_1(n_1+1)}/2}{n_0}$$

where $\bar{R}_{1}$ is the mean rank for $s_i$ where $y_i=1$:

$$\bar{R}_{1} = \frac{1}{n_1}\sum_{i:y_i=1}\text{Rank}(s_i)$$

# Efficiency study

# Case studies

--> studieS, jeżeli będzie więcej <--

## DALEX package

--> Wykres generuje się długo, a możemy go przyśpieszyć <--

# Summary
